window.DL=window.DL||{};(function(_,Modernizr,$,DL){"use strict";var search=_.create(Object.prototype,{createCloseBtn:function(){if(!this.submitEl||DL.Utils.Functions.classList(document.body).contains("is-winIE")){return null}var closeBtn,wrapper=document.createElement("div");DL.Utils.Functions.classList(wrapper).add("dlsearch-submit-wrapper");wrapper.appendChild(this.submitEl);closeBtn=document.createElement("i");closeBtn.setAttribute("aria-hidden","true");DL.Utils.Functions.classList(closeBtn).add("dlsearch__form-close","la","la-close");wrapper.appendChild(closeBtn);this.form.appendChild(wrapper);return closeBtn},hideCloseBtn:function(){if(this.closeBtn){this.closeBtn.style.display="none"}},showCloseBtn:function(){if(this.closeBtn){this.closeBtn.style.display="inherit"}},showHideHeaderElements:function(action){var currEl,opacity="show"===action?1:0,visibility="show"===action?"visible":"hidden";for(var i=0;i!==this.search.parentElement.childElementCount;++i){currEl=this.search.parentElement.children[i];if(!DL.Utils.Functions.classList(currEl).contains("dlsearch")){currEl.style.opacity=opacity;currEl.style.visibility=visibility}}},toggleNavigation:function(force){if(this.nav){var opacity=this.isOpen?1:0;if(force){opacity=parseFloat(force)}$(this.nav).animate({opacity:opacity},{queue:false,duration:100})}return this},blur:function(){this.inputSearch.blur()},focus:function(){this.inputSearch.focus()},toggleSkin:function(){var classes=this.header.getAttribute("class"),prevSkin=this.header.getAttribute("data-currentskin");if(!prevSkin){if(classes){classes=classes.split(" ");_.forEach(classes,function(item){if(-1!==item.indexOf("--skin-")){prevSkin=item.substring(item.indexOf("--skin-")+7)}})}this.header.setAttribute("data-currentskin",prevSkin)}if("transparent"===prevSkin){DL.Utils.Functions.classList(this.header).toggle("dlheader--skin-"+prevSkin);DL.Utils.Functions.classList(this.header).toggle("dlheader--skin-transparent-dark")}},open:function(evt){evt.preventDefault();evt.stopPropagation();if(this.isOpen){return}var isSafariMobile=DL.Utils.Functions.classList(document.body).contains("is-safari")&&Modernizr.touchevents;var inputSearchWidth=0,logoRect,logo=this.header.querySelector(".dlbrand");if(logo){logoRect=logo.getClientRects()[0]}if(this.breakPoint>=window.innerWidth||this.isMobile){inputSearchWidth=window.innerWidth-this.submitEl.offsetWidth;this.showHideHeaderElements("hide")}if(this.breakPoint<window.innerWidth&&!this.isMobile){this.toggleNavigation();if(logoRect){inputSearchWidth=this.form.getClientRects()[0].left-(logoRect.width+logoRect.left)}}setTimeout(function(){$(this.inputSearch).stop().animate({width:Math.round(inputSearchWidth),opacity:1},{queue:false,duration:257,start:function(){this.form.style.position="absolute";this.form.style.right=0;this.form.style.top=0;this.form.style.bottom=0;this.form.style.zIndex=9999;this.toggleSkin()}.bind(this),complete:function(){this.isOpen=true;DL.Utils.Functions.classList(this.form).add("dlsearch__form--open");if(!isSafariMobile){this.focus()}this.showCloseBtn();DL.Utils.Functions.classList(document.body).add("dldocument-blocked")}.bind(this)})}.bind(this),257);if(isSafariMobile){this.focus()}return this},closeByKey:function(e){if(document.activeElement===this.inputSearch&&27===e.keyCode){this.blur()}return this},close:function(e){e.preventDefault();e.stopPropagation();if(!this.isOpen){return}if(!_.isUndefined(e)){if(DL.Utils.Functions.classList(e.target).contains('dlsearch input[type="search"]')&&"keyup"!==e.type){return}}this.hideCloseBtn();this.inputSearch.value="";this.inputSearch.blur();this.toggleSkin();$(this.inputSearch).stop(false,true).animate({width:1,opacity:0,padding:0},{queue:false,duration:257,done:function(){if(this.breakPoint<=window.innerWidth||this.isMobile){this.toggleNavigation(1)}}.bind(this),complete:function(){this.isOpen=false;DL.Utils.Functions.classList(this.form).remove("dlsearch__form--open");this.form.zIndex=1;if(this.breakPoint>=window.innerWidth||this.isMobile){this.showHideHeaderElements("show")}this.form.removeAttribute("style");DL.Utils.Functions.classList(document.body).remove("dldocument-blocked")}.bind(this)});return this},toggle:function(e){e.stopImmediatePropagation();this.isToggling=true;if(this.isOpen){this.close()}else{this.open()}this.isToggling=false;return this},closeOnResize:function(){var searchTimer;clearTimeout(searchTimer);searchTimer=setTimeout(function(){if(this.isOpen&&!DL.Utils.Functions.classList(document.body).contains("is-mobile")){this.showHideHeaderElements("show");this.close()}}.bind(this),100)},submitByKey:function(evt){if(13===evt.keyCode){this.form.submit()}},setListeners:function(){DL.Utils.Events.addListener(this.submitEl,"click",this.open);DL.Utils.Events.addListener(this.closeBtn,"click",this.close);DL.Utils.Events.addListener(this.inputSearch,"keyup",this.closeByKey);DL.Utils.Events.addListener(this.inputSearch,"blur",this.close);DL.Utils.Events.addListener(window,"orientationchange",this.close);DL.Utils.Events.addListener(window,"resize",this.closeOnResize);DL.Utils.Events.addListener(this.form,"keyup",this.submitByKey)},init:function(){this.isOpen=false;this.isToggling=false;this.setListeners();return this},construct:function(){_.bindAll(this,"createCloseBtn","hideCloseBtn","showCloseBtn","showHideHeaderElements","toggleNavigation","blur","focus","toggleSkin","open","closeByKey","close","toggle","setListeners","closeOnResize","init","submitByKey");this.breakPoint=1024;this.isMobile=DL.Utils.Functions.classList(document.body).contains("is-mobile");this.header=document.querySelector(".dlheader");if(!this.header){return}this.search=this.header.querySelector(".dlsearch");if(!this.search){return}this.form=this.search.querySelector(".dlsearch__form");if(!this.form){return}this.inputSearch=this.form.querySelector('.dlsearch input[type="search"]');if(!this.inputSearch){return}this.submitEl=this.form.querySelector(".dlsearch__form-submit");this.nav=this.header.querySelector(".dlnav-main");this.closeBtn=this.createCloseBtn();this.hideCloseBtn();return this}});document.addEventListener("DOMContentLoaded",function(){if(search.construct()){search.init()}})})(_,window.Modernizr,window.jQuery,window.DL);