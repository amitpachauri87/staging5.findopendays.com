window.DL=window.DL||{};(function(_,$,DL,url,localized){"use strict";DL.WishListAdder={toggleLoader:function(){DL.Utils.UI.toggleLoader(this.element)},statusToggle:function(){DL.Utils.Events.dispatchEvent("wishlist_item_status_update",this.element,null,{dispatcher:this});this.action="remove"===this.action?"store":"remove";DL.Utils.Functions.classList(this.element).toggle("is-stored")},running:function(){DL.Utils.Functions.classList(this.element).add("is-running")},removeOnStatusUpdate:function(evt){var that=evt.detail.dispatcher;if(_.isUndefined(that)){return}var isAllowed=_.has(url("?",that.element.getAttribute("href")),"hide-on-remove");if("remove"===that.action&&isAllowed){$(that.element).fadeOut(function(){that.container.remove()})}},act:function(data){this.statusToggle();$.ajax({url:this.href,data:data,method:"POST",cache:false,dataType:"json",beforeSend:function(){this.running()}.bind(this),complete:function(xhr,status){DL.Utils.Functions.classList(this.element).remove("is-running")}.bind(this),error:function(xhr,status,error){this.statusToggle();console.warn("Wishlist "+error,status)}.bind(this),success:function(data,status,xhr){}.bind(this)})},prepareData:function(){if(!this.container&&!this.element){return false}var postID=this.element.getAttribute("data-post-id");return{post_id:postID,dlajax_action:"wishlist",crud_action:this.action,wishlist_nonce:this.nonce}},add:function(evt){evt.preventDefault();evt.stopPropagation();if(!localized.loggedin){return false}var data=this.prepareData();if(data){this.act(data)}},init:function(){DL.Utils.Events.addListener(this.element,"click",this.add,{capture:true});DL.Utils.Events.addListener(this.element,"wishlist_item_status_update",this.removeOnStatusUpdate);if(!localized.loggedin&&_.isFunction(DL.LoginRegisterFormFactory)){DL.LoginRegisterFormFactory(this.element).init()}return this},construct:function(element){if(!element){return}_.bindAll(this,"toggleLoader","statusToggle","act","prepareData","add","removeOnStatusUpdate","running","init");var data=url("?",element.getAttribute("href"));this.href=url("path",element.getAttribute("href"));this.nonce=data.nonce;this.action=data.action;this.element=element;this.container=$(this.element).closest(".dlarticle")[0];return this}};DL.WishListAdderFactory=function(element){return Object.create(DL.WishListAdder).construct(element)};DL.WishlistCollectionBuilder=function(){var elements=document.querySelectorAll(".dlwishlist-adder");elements&&_.forEach(elements,function(element){var wishlist=DL.WishListAdderFactory(element);wishlist&&wishlist.init()})};window.addEventListener("load",function(){DL.WishlistCollectionBuilder()})})(window._,window.jQuery,window.DL,window.url,window.dllocalized);